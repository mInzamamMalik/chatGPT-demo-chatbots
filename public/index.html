<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatGPT DEMO</title>
</head>

<body>

    <nav>
        <button><a href="./index.html">Depression counselor</a></button>
        <button><a href="./apple_store.html">Apple Store</a></button>
        <button><a href="./grove_store.html">Grove Store</a></button>
    </nav>

    <h1>Depression counselor chatbot</h1>
    <p>if you are feeling depressed, try talking to this chatbot. say whatever you feel - Powered by Openai ChatGPT </p>

    <form onsubmit="sub(event); return false">
        your profile:
        <br>
        <select name="gender" id="gender" required>
            <option value="male">male</option>
            <option value="female">female</option>
        </select>
        <br>
        <select name="country" id="country">
            <option value="Pakistan">Pakistan</option>
            <option value="China">China</option>
            <option value="India">India</option>
            <option value="United States">United States</option>
            <option value="Indonesia">Indonesia</option>
            <option value="Pakistan">Pakistan</option>
            <option value="Brazil">Brazil</option>
            <option value="Nigeria">Nigeria</option>
            <option value="Bangladesh">Bangladesh</option>
            <option value="Russia">Russia</option>
            <option value="Mexico">Mexico</option>
        </select>
        <br>
        note: changing profile in the middle of conversation may cause malfunction, so please set your profile in the
        beginning of the conversation and do not change through out the conversation.
        <br>
        <br>

        <textarea placeholder="your message" type="text" id="query" autofocus style="width: 50%;"></textarea>

        <button type="Submit">Submit</button>
    </form>

    <p id="result"></p>
    <p id="hidden" style="display: none;"></p>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script type="module">

        window.sub = async function sub(event) {
            try {

                const start_sequence = "\n\nCounselor:"
                const restart_sequence = "\n\nYou: "

                const query = document.querySelector("#query").value;
                const result = document.querySelector("#result")
                const hidden = document.querySelector("#hidden")

                result.innerText = `${restart_sequence} ${query}` + result.innerText
                hidden.innerText += `${restart_sequence} ${query}`

                console.log(event.target.reset());
                const res = await axios.post("/depression", {
                    "text": hidden.innerText,
                    "gender": document.querySelector("#gender").value,
                    "country": document.querySelector("#country").value,
                    start_sequence,
                    restart_sequence,
                })

                console.log("response: ", res.data.choices);
                console.log("response: ", res.data.choices[0]);
                console.log("response: ", res.data.choices[0].text);

                result.innerText = `${start_sequence} ${res.data.choices[0].text}` + result.innerText;
                hidden.innerText += `${start_sequence} ${res.data.choices[0].text}`

            } catch (error) {
                console.log("error: ", error.response || error);
            }
        }


    </script>

</body>

</html>